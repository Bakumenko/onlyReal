# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–≥–æ, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ä–µ–±—Ä–æ –æ–±—Ä–∞—Ç–Ω—ã–º –∏ —è–≤–ª—è–µ–µ—Ç—Å—è –ª–∏ CFG –ø—Ä–∏–≤–æ–¥–∏–º—ã–º !heading

### –ö–æ–º–∞–Ω–¥–∞ GreatBean

## –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ä–µ–±—Ä–æ –æ–±—Ä–∞—Ç–Ω—ã–º !heading

#### –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–π—Ç–∏ –≤ CFG –≥—Ä–∞—Ñ–µ —Ä–µ–±—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω—ã–º–∏.

#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–¥–∞—á –≤ –≥—Ä–∞—Ñ–µ –∑–∞–¥–∞—á
–ó–∞–¥–∞—á–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
* –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–æ–º–∏–Ω–∞—Ç–æ—Ä–æ–≤

#### –¢–µ–æ—Ä–∏—è
–ó–∞–¥–∞—á–∞ —è–≤–ª—è–µ—Ç—Å—è —Å—É–≥—É–±–æ —Ç–µ–æ—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π.

###### –û–±—Ä–∞—Ç–Ω—ã–µ —Ä–µ–±—Ä–∞ (back edjes)
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ. –û–±—Ä–∞—Ç–Ω—ã–º –≤ –≥—Ä–∞—Ñ–µ CFG –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–±—Ä–æ ùëé ‚Üí ùëè, —É –∫–æ—Ç–æ—Ä–æ–≥–æ ùëè –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç –Ω–∞–¥ ùëé.


#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–≥–æ, —á—Ç–æ —Ä–µ–±—Ä–æ –°ontrol Flow Graph —è–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω—ã–º —Å–ø–µ—Ä–≤–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–π—Ç–∏ —Å–ø–∏—Å–æ–∫ –¥–æ–º–∏–Ω–∞—Ç–æ—Ä–æ–≤ CFG. –¢–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É CFG –¥–ª—è –µ–µ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –æ–±—Ö–æ–¥–∞. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–±—Ä–∞ –∏–∑ CFG –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–µ—Ä—à–∏–Ω–∞, –≤ –∫–æ—Ç–æ—Ä—É—é –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ä–µ–±—Ä–æ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç –Ω–∞–¥ –≤–µ—Ä—à–∏–Ω–æ–π, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π —Ä–µ–±—Ä–æ –≤—ã—Ö–æ–¥–∏—Ç. –≠—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É –º—ã –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫–æ–º —Å–æ–æ—Ç–≤–µ—Ç–≤—É—é—â–∏—Ö –¥–æ–º–∏–Ω–∞—Ç–æ—Ä–æ–≤ –≤ —Å–ø–∏—Å–∫–µ –¥–æ–º–∏–Ω–∞—Ç–æ—Ä–æ–≤.

–î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å DetectReversibleEdges.
```csharp
class DetectReversibleEdges
{
    Dictionary<int, List<int>> dominators;
    List<Edge> edges;
    // —Å–ª–æ–≤–∞—Ä—å, –≥–¥–µ –∫–∞–∂–¥–æ–º—É —Ä–µ–±—Ä—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ bool, –µ—Å–ª–∏ —Ä–µ–±—Ä–æ –æ–±—Ä–∞—Ç–∏–º–æ-true, –∏–Ω–∞—á–µ false
    Dictionary<Edge, bool> isReversible = new Dictionary<Edge, bool>();

    //–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
    public DetectReversibleEdges(ControlFlowGraph.ControlFlowGraph cfg)
    {
        var dom = new DominatorsFinder(cfg);
        dominators = dom.Find();

        var spt = new SpanTree(cfg);
        edges = spt.buildSpanTree();

        foreach (var e in edges)
            isReversible[e] = dominators.Keys.Contains(e.v1.num)
                && dominators[e.v1.num].Contains(e.v2.num);
    }

    // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å isReversible
    public Dictionary<Edge, bool> isRevers()
    {
        return isReversible;
    }

    // –í—ã–≤–æ–¥–∏—Ç —Å–ª–æ–≤–∞—Ä—å isReversible –≤ –∫–æ–Ω—Å–æ–ª—å
    public void PrintIsReverseDic()
    {
        var dic = isRevers();
        foreach (var x in dic)
            Console.WriteLine("Edge {0} -> {1} is {2}", x.Key.v1.num.ToString(),  
                x.Key.v2.num.ToString(), x.Value? "reverse" : "not reverse");
    }
}
```

#### –¢–µ—Å—Ç—ã
–ò–∑ –∏—Å—Ö–æ–¥–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤–∏–¥–∞
```csharp
{
  int a,b;
  a = 3;
  b = a;
  while (a > 0)
  {
    a = a - 1;
  }
  while (a > 0)
  {
    a = a - 1;
  }
}
```

–ú—ã –ø–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç –≤ –≤–∏–¥–µ
```
Edge 1 -> 2 is not reverse
Edge 2 -> 3 is not reverse
Edge 2 -> 4 is not reverse
Edge 3 -> 5 is not reverse
Edge 4 -> 2 is reverse
Edge 5 -> 6 is not reverse
Edge 5 -> 7 is not reverse
Edge 6 -> 8 is not reverse
Edge 7 -> 5 is reverse
```
## –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ CFG –ø—Ä–∏–≤–æ–¥–∏–º—ã–º !heading

#### –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –≤ CFG –ø—Ä–∏–≤–æ–¥–∏–º—ã–º.

#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–¥–∞—á –≤ –≥—Ä–∞—Ñ–µ –∑–∞–¥–∞—á
–ó–∞–¥–∞—á–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
* –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–æ–º–∏–Ω–∞—Ç–æ—Ä–æ–≤
* –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω—ã—Ö —Ä–µ–±–µ—Ä CFG

#### –¢–µ–æ—Ä–∏—è
–ó–∞–¥–∞—á–∞ —è–≤–ª—è–µ—Ç—Å—è —Å—É–≥—É–±–æ —Ç–µ–æ—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π.

###### –ü—Ä–∏–≤–æ–¥–∏–º–æ—Å—Ç—å –≥—Ä–∞—Ñ–∞ –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ. –ì—Ä–∞—Ñ –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–≤–æ–¥–∏–º—ã–º –µ—Å–ª–∏ –≤—Å–µ –µ–≥–æ –æ—Ç—Å—Ç—É–ø–∞—é—â–∏–µ —Ä–µÃà–±—Ä–∞ —è–≤–ª—è—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω—ã–º–∏.


#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–≥–æ, —á—Ç–æ –°ontrol Flow Graph —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–≤–æ–¥–∏–º—ã–º —Å–ø–µ—Ä–≤–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–π—Ç–∏ —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞—Ç–Ω—ã—Ö —Ä–µ–±–µ—Ä. –ü–æ—Å–ª–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—Ç–Ω—ã—Ö –∏ –æ—Ç—Å—Ç—É–ø–∞—é—â–∏—Ö —Ä–µ–±–µ—Ä.

–î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å DetectReversibleEdges.
```csharp
class DetectReversibleEdges
{
    Dictionary<int, List<int>> dominators;
    List<Edge> edges;
    // —Å–ª–æ–≤–∞—Ä—å, –≥–¥–µ –∫–∞–∂–¥–æ–º—É —Ä–µ–±—Ä—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ bool, –µ—Å–ª–∏ —Ä–µ–±—Ä–æ –æ–±—Ä–∞—Ç–∏–º–æ-true, –∏–Ω–∞—á–µ false
    Dictionary<Edge, bool> isReversible = new Dictionary<Edge, bool>();

    //–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
    public DetectReversibleEdges(ControlFlowGraph.ControlFlowGraph cfg)
    {
        var dom = new DominatorsFinder(cfg);
        dominators = dom.Find();

        var spt = new SpanTree(cfg);
        edges = spt.buildSpanTree();

        foreach (var e in edges)
            isReversible[e] = dominators.Keys.Contains(e.v1.num)
                && dominators[e.v1.num].Contains(e.v2.num);
    }

    // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å isReversible
    public Dictionary<Edge, bool> isRevers()
    {
        return isReversible;
    }

    // –í—ã–≤–æ–¥–∏—Ç —Å–ª–æ–≤–∞—Ä—å isReversible –≤ –∫–æ–Ω—Å–æ–ª—å
    public void PrintIsReverseDic()
    {
        var dic = isRevers();
        foreach (var x in dic)
            Console.WriteLine("Edge {0} -> {1} is {2}", x.Key.v1.num.ToString(),  
                x.Key.v2.num.ToString(), x.Value? "reverse" : "not reverse");
    }

    //–§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≥—Ä–∞—Ñ –ø—Ä–∏–≤–æ–¥–∏–º—ã–º.
    //–ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Å—Ç—É–ø–∞—é—â–∏—Ö —Ä—ë–±–µ—Ä —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–±—Ä–∞—Ç–∏–º—ã—Ö, —Ç–æ –≥—Ä–∞—Ñ –ø—Ä–∏–≤–æ–¥–∏–º
    public bool isReducible()  
    {
        int countBack = 0;
        int countReversible = 0;
        foreach(var e in edges)
            if (e.type == EdgeType.Back)
                countBack++;

        foreach (var i in isReversible)
            if (i.Value)
                countReversible++;

        return countBack == countReversible;
    }

    // –í—ã–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å —Ñ–∞–∫—Ç –ø—Ä–∏–≤–æ–¥–∏–º–æ—Å—Ç–∏ CFG
    public void PrintisReducible()
    {
        Console.WriteLine("CFG is {0}", isReducible() ? "reducibile" : "not reducibile");
    }
}
```

#### –¢–µ—Å—Ç—ã
–ò–∑ –∏—Å—Ö–æ–¥–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤–∏–¥–∞
```csharp
{
  int a,b;
  a = 3;
  b = a;
  while (a > 0)
  {
    a = a - 1;
  }
  while (a > 0)
  {
    a = a - 1;
  }
}
```

–ú—ã –ø–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç –≤ –≤–∏–¥–µ

CFG is reducibile

[–í–≤–µ—Ä—Ö](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

