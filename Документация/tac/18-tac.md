# Удаление мертвых переменных на основе итерационного алгоритма !heading

### Команда Roll

#### Постановка задачи
На основе анализа активных переменных произвести удаление мертвых переменных для всех блоков программы.

#### Зависимости задач в графе задач

Задача зависит от:
* Итерационный алгоритм для активных переменных
* Построение графа потока управления

#### Теория
Чтобы удалить мертвые переменные, учитывая связи между блоками кода, необходим анализ потоков данных. При выполнении итерационного алгоритма для активных переменных находятся множества IN и OUT для каждого из блоков. Именно множества OUT хранят переменные, которые являются активными на выходе из блоков. Если переменная входит в OUT, значит в начале анализа отдельного блока она активна, иначе она мертва и может быть удалена.


#### Особенности реализации
Для использования данной оптимизации необходимо:
1. Подключить пространство имен using SimpleLang.ThreeCodeOptimisations;
2. Построить граф по блокам с фиктивными узлами
3. Вычислить множества Def и Use, используя клас DefUseBlocks
4. Вычислить множества IN и OUT для активных переменных с помощью класса InOutActiveVariables
5. Применить оптимизацию к графу и множествам OUT

Ниже представлен код использования данной оптимизации:
```
// получение трехадресного кода
ThreeAddressCodeVisitor threeCode = new ThreeAddressCodeVisitor();
r.Visit(threeCode);

// разбиение на блоки
var blocks = new Block(threeCode).GenerateBlocks();

// построение CFG по блокам
CFG controlFlowGraph = new CFG(blocks);

// вычисление множеств Def и Use для всего графа потоков данных
var DefUse = new DefUseBlocks(controlFlowGraph);
// вычисление множеств IN, OUT на основе DefUse
var Out = new InOutActiveVariables(DefUse, controlFlowGraph).OutBlocks;
controlFlowGraph = ControlFlowOptimisations.DeadOrAliveOnGraph(Out, controlFlowGraph);
```

#### Тесты
``` charp
Исходный код программы
{
    int a,b,c;
    a = 500;
    b = 200;
    if (2)
    {
        a = b;
        b = 100;
        b = (c + 4);
        a = 30;
    }
    else {
    }
    println(a);
    println(b);
}

Блоки трехадресного кода до каскадного удаления мертвых переменных
entry:
           a = 500
           b = 200
           if 2 goto label_0
           goto label_1
label_0:
           a = b
           b = 100
           b = c + 4
           a = 30
label_1:   println a
           println b

После каскадного удаления мертвых переменных для всей программы
           b = 200
           if 2 goto label_0
           goto label_1
label_0:
label_1:   println a
           println b
```

[Вверх](#содержание)