# Оптимизация while false !heading

### Команда Roll

#### Постановка задачи
Выполнить замену выражений while (false) st; на null для AST.

#### Зависимости задач в графе задач

Задача зависит от:
* Построение AST

#### Теория
Оптимизации на AST являются достаточно простыми и в то же время важными, так как позволяют убирать целые блоки кода или выражения еще до генерации кода. Данный тип оптимизаций выполняется с помощью шаблона проектирования Visitor, который позволяет изменять однотипные сущности. В нашем случае это узлы AST. Очевидно, что в while (false) st; st - недостижимый код, подлежащий удалению.


#### Особенности реализации
Для использования данной оптимизации необходимо:
1. Подключить пространство имен SimpleLang.Visitors;
2. Построить AST
3. Проставить ссылки на родителей для каждого узла
4. Создать визитор OptWhileVisitor и применить его к AST

Ниже представлен код использования данной оптимизации:
```csharp
// синтаксическое дерево уже построено
	var r = parser.root;	// корень AST
	r.Visit(new FillParentVisitor());	// установка ссылок на родителей на AST
	r.Visit(new OptWhileVisitor());	// выполнение текущей оптимизации
```
Далее AST используется для генерации трехадресного, а затем IL кода.


#### Тесты
```
Исходный код до оптимизации
{
    var a,b;
    a = (((((1 * 1) / 2) / 1) + (a * 1)) + (1 * a));
    while (false)
    {
        while ((((a * 1) + (b / 1)) + (1 * a)))
        {

        }
    }
    a = 2;
}
После оптимизации:
{
    var a,b;
    a = (((1 / 2) + a) + a);
    while (false)
    {
        while (((a + b) + a))
        {

        }
    }
    a = 2;
}
```

[Вверх](#содержание)